# 防火墙的产生
Internet提供便利的时候，使得外部世界能够接触到本地网络资源并产生影响。
有时候入侵检测也许不能满足要求，而且在某些情况下不划算（可能修复一个安全缺陷的成本过大）

基于主机的安全服务的一种补充就是防火墙

# 防火墙的特征
1. 入出站的流量经过防火墙
2. 经过授权的网络流量（符合本地安全策略）才被允许通过
3. 防火墙本身不能被渗透

# 防火墙的局限性
1. 防火墙不能阻止那些绕开防火墙的攻击
	1. 内部系统可能有拨号上网的功能
	2. 内部局域网可以支持调制解调器池，为外地出差的职员提供拨号进入系统的功能
2. 防火墙不能完全防止内部威胁
3. 内部防火墙不能阻止本地系统与其他被内部防护墙分割的部分通信
4. 笔记本在企业网外被感染之后连接到内部网络使用

# 防火墙的类型
## 包过滤防火墙
根据一组规则来检查每个接收和发送的IP包，然后决定转发或则丢弃此包。
过滤规则基于网络包中所包含的信息。

这个规则集存在几个问题
1. 规则4允许任何目标端口号大于1023的外部流量进入。即外部攻击者可以建立一个从攻击者5150端口到内部Web代理服务器8080端口的链接，可能导致服务器被攻击。
	1. 为了应对这种问题，防火墙规则集的每一行应该添加一个源端口列，对于规则2和规则4来说，源端口号应该被设定为25
	2. 对于规则1和规则3来说，源端口号应该被设定为大于1023.
2. ![[截屏2022-11-29 10.25.39.png]]

## 状态检测防火墙
一个简单的包过滤防火墙必须允许所有高端口上的基于TCP的入栈网络流量。
这就产生了可以被非法用户利用的漏洞。
状态检测防火墙会记录TCP连接信息，还跟踪TCP包的序号，以阻止基于序号的攻击，例如会话劫持攻击。

## 应用级网关
![[截屏2022-11-29 10.32.30.png]]
## 电路级网关
![[截屏2022-11-29 10.33.26.png]]
![[截屏2022-11-29 10.34.27.png]]
# 防火墙的布置
## 堡垒主机
![[截屏2022-11-29 10.35.25.png]]
## 基于主机的防火墙
![[截屏2022-11-29 10.36.32.png]]![[截屏2022-11-29 10.36.40.png]]
## 个人防火墙
![[截屏2022-11-29 10.37.32.png]]
![[截屏2022-11-29 10.37.45.png]]
## DMZ网络
![[截屏2022-11-29 10.38.52.png]]
## 虚拟专用网络
防火墙会对发送的信息加密，通过公用网络到达对方的防火墙，然后解密，到达对方的结点

所以虽然是在公网上路由拓扑传送，但是消息只由发送方和接受方知道，相当于是专用网络，除非在发送端接线窃听，不然不能知道发送的消息。

![[截屏2022-11-29 10.41.44.png]]![[截屏2022-11-29 10.41.59.png]]![[截屏2022-11-29 10.42.23.png]]![[截屏2022-11-29 10.42.36.png]]
# 防火墙拓扑结构
![[截屏2022-11-29 10.44.12.png]]![[截屏2022-11-29 10.44.19.png]]
